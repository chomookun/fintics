<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="_web.html">
<th:block layout:fragment="_content">
    <script th:inline="javascript">
        // defines
        const realizedProfitSearch = new duice.ObjectProxy({
            brokerId: null,
            dateFrom: null,
            dateTo: null
        });
        const brokers = new duice.ArrayProxy(/*[[${brokers}]]*/[]);
        const realizedProfits = new duice.ArrayProxy([]);

        /**
         * gets realized profits
         */
        function getRealizedProfits() {
            let url = new URL(`${_apiUrl}/v1/realized-profits/${realizedProfitSearch.brokerId}`, document.location.origin);
            if (realizedProfitSearch.dateFrom && realizedProfitSearch.dateTo) {
                // TODO
            }
            _fetch(url)
                .then(response => {
                    return response.json();
                })
                .then(data => {
                    duice.ArrayProxy.assign(realizedProfits, data);
                });
        }

        // event listener
        document.addEventListener('DOMContentLoaded', () => {
        });
    </script>
    <style th:inline="css">
    </style>

    <!-- ====================================== -->
    <!-- start: title                           -->
    <!-- ====================================== -->
    <h1 id="title">
        <img class="icon" th:src="@{/static/image/icon-realized-profit.svg}" alt="realized-profit"/>
        <span data-th-text="#{fintics.RealizedProfit}"></span>
    </h1>
    <!-- ====================================== -->
    <!-- end: title                             -->
    <!-- ====================================== -->

    <!-- ================================== -->
    <!-- start: order                       -->
    <!-- ================================== -->
    <div class="display--flex flex-direction--column border--1 padding--1em">
        <div class="display--flex flex-direction--column gap--1em padding--1em s__padding-y--0">
            <form onsubmit="return false;" class="display--grid grid-template-columns--12 grid-gap--1em">
                <div class="grid-column--12 s__grid-column--12 display--grid grid-template-columns--12 grid-gap--1em">
                    <label class="grid-column--8 s__grid-column--12">
                        <select data-duice-bind="realizedProfitSearch"
                                data-duice-property="brokerId"
                                data-duice-option="brokers"
                                data-duice-option-value-property="brokerId"
                                data-duice-option-text-property="name">
                            <option value="" data-th-text="'- ' + #{fintics.Broker} + ' -'"></option>
                        </select>
                    </label>
                    <div class="grid-column--4 s__grid-column--12 justify-self--end">
                        <button type="submit" onclick="getRealizedProfits();">
                            <img class="icon" th:src="@{/static/image/icon-search.svg}" alt="search"/>
                            <span data-th-text="#{web.global.search}"></span>
                        </button>
                    </div>
                </div>
            </form>
            <div class="overflow-x--scroll">
                <table class="width--100">
                    <colgroup>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                        <col/>
                    </colgroup>
                    <thead>
                    <tr>
                        <th data-th-text="#{fintics.RealizedProfit.date}"></th>
                        <th data-th-text="#{fintics.RealizedProfit.symbol}"></th>
                        <th data-th-text="#{fintics.RealizedProfit.name}"></th>
                        <th data-th-text="#{fintics.RealizedProfit.quantity}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.purchasePrice}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.purchaseAmount}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.disposePrice}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.disposeAmount}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.feeAmount}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.profitAmount}" class="text-align--right"></th>
                        <th data-th-text="#{fintics.RealizedProfit.profitPercentage}" class="text-align--right"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr data-duice-bind="realizedProfits" data-duice-loop="realizedProfit,status">
                        <td>
                        <span data-duice-bind="realizedProfit"
                              data-duice-property="date"
                              data-duice-format="date('yyyy-MM-dd')"></span>
                        </td>
                        <td>
                            <span data-duice-bind="realizedProfit" data-duice-property="symbol"></span>
                        </td>
                        <td>
                            <span data-duice-bind="realizedProfit" data-duice-property="name"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="quantity" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="purchasePrice" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="purchaseAmount" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="disposePrice" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="disposeAmount" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="feeAmount" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="profitAmount" data-duice-format="number"></span>
                        </td>
                        <td class="text-align--right">
                            <span data-duice-bind="realizedProfit" data-duice-property="profitPercentage" data-duice-format="number"></span>
                            %
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="100%" class="text-align--right">
                            <span data-duice-bind="realizedProfits"
                            data-duice-execute="
                            const totalProfitAmount = realizedProfits.reduce((sum, realizedProfit) => sum + realizedProfit.profitAmount, 0);
                            const formattedTotalProfitAmount = totalProfitAmount.toLocaleString();
                            this.innerHTML = formattedTotalProfitAmount;
                            "
                            class="font-weight--bold">
                            </span>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    <!-- ================================== -->
    <!-- end: order                       -->
    <!-- ================================== -->

</th:block>
